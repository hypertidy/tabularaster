<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools for Rasters as Tidy Data • tabularaster</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">tabularaster</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">

<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="tabularaster" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#tabularaster" class="anchor"></a>tabularaster</h1></div>
<p>The <code>raster</code> package is extremely powerful in the R ecosystem for spatial data. It can be used very efficiently to drive data extraction and summary tools using its consistent cell-index and comprehensive helper functions for converting between cell values and less abstract raster grid properties.</p>
<p>Tabularaster provides some more helpers for working with cells and tries to fill some of the (very few!) gaps in raster functionality. When raster returns cell values of hierarchical objects it returns a hierarchical (list) of cells to match the input query.</p>
<p>Tabularaster provides:</p>
<ul>
<li>extraction of cells as a simple data frame with “object ID” and “cell index”</li>
<li>a “buffer extent” capability to snap an extent to a tidy “whole grain” alignment</li>
<li>a “decimate” function for fast as possible resolution reduction</li>
</ul>
<p>If this seems a little miscellaneous, well it is but it’s at least a tidy place to collect these functions while I figure out where they belong. There are some parts, especially the dumb sharkcano joke that have some overlap with the “quadmesh” package.</p>
</div>
<div id="extract-cells-from-rasters-and-get-a-nice-data-frame-" class="section level1">
<h1 class="hasAnchor">
<a href="#extract-cells-from-rasters-and-get-a-nice-data-frame-" class="anchor"></a>Extract cells from rasters and get a nice data frame.</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tabularaster)
<span class="kw">library</span>(raster)
<span class="co">#&gt; Loading required package: sp</span>
<span class="kw">library</span>(dplyr)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, select, union</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw">data</span>(<span class="st">"rastercano"</span>)
<span class="kw">data</span>(<span class="st">"polycano"</span>)
cells &lt;-<span class="st"> </span><span class="kw"><a href="reference/cellnumbers.html">cellnumbers</a></span>(rastercano, polycano[<span class="dv">4</span>:<span class="dv">5</span>, ])
<span class="co">#&gt; Warning in cellnumbers(rastercano, polycano[4:5, ]): projections not the same </span>
<span class="co">#&gt;     x: NA</span>
<span class="co">#&gt; query: NA</span>


<span class="kw"><a href="reference/cellnumbers.html">cellnumbers</a></span>(rastercano, <span class="kw">as</span>(polycano[<span class="dv">4</span>:<span class="dv">5</span>, ], <span class="st">"SpatialLinesDataFrame"</span>))
<span class="co">#&gt; Warning in cellnumbers(rastercano, as(polycano[4:5, ], "SpatialLinesDataFrame")): projections not the same </span>
<span class="co">#&gt;     x: NA</span>
<span class="co">#&gt; query: NA</span>
<span class="co">#&gt; # A tibble: 235 x 2</span>
<span class="co">#&gt;    object_ cell_</span>
<span class="co">#&gt;      &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1       1  1129</span>
<span class="co">#&gt;  2       1  1190</span>
<span class="co">#&gt;  3       1  1251</span>
<span class="co">#&gt;  4       2     1</span>
<span class="co">#&gt;  5       2     2</span>
<span class="co">#&gt;  6       2     3</span>
<span class="co">#&gt;  7       2     4</span>
<span class="co">#&gt;  8       2     5</span>
<span class="co">#&gt;  9       2     6</span>
<span class="co">#&gt; 10       2     7</span>
<span class="co">#&gt; # ... with 225 more rows</span>
<span class="kw"><a href="reference/cellnumbers.html">cellnumbers</a></span>(rastercano, <span class="kw">as</span>(<span class="kw">as</span>(polycano[<span class="dv">4</span>:<span class="dv">5</span>, ], <span class="st">"SpatialLinesDataFrame"</span>), <span class="st">"SpatialPointsDataFrame"</span>))
<span class="co">#&gt; Warning in cellnumbers(rastercano, as(as(polycano[4:5, ], "SpatialLinesDataFrame"), : projections not the same </span>
<span class="co">#&gt;     x: NA</span>
<span class="co">#&gt; query: NA</span>
<span class="co">#&gt; # A tibble: 331 x 2</span>
<span class="co">#&gt;    object_ cell_</span>
<span class="co">#&gt;      &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1       1  1129</span>
<span class="co">#&gt;  2       2  1129</span>
<span class="co">#&gt;  3       3  1251</span>
<span class="co">#&gt;  4       4  1251</span>
<span class="co">#&gt;  5       5  1129</span>
<span class="co">#&gt;  6       6  1098</span>
<span class="co">#&gt;  7       7  1098</span>
<span class="co">#&gt;  8       8  1098</span>
<span class="co">#&gt;  9       9  1098</span>
<span class="co">#&gt; 10      10  1037</span>
<span class="co">#&gt; # ... with 321 more rows</span>

## weights not workin
<span class="co">#xweight &lt;- cellnumbers(rastercano, polycano[4:5, ], weights = TRUE)</span>
<span class="co">#xweight  %&gt;% group_by(object_)  %&gt;% summarize(sum(weight_))</span></code></pre></div>
</div>
<div id="buffer-out-an-extent-to-a-whole-grain" class="section level1">
<h1 class="hasAnchor">
<a href="#buffer-out-an-extent-to-a-whole-grain" class="anchor"></a>Buffer “out” an extent to a whole grain</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wholegrain &lt;-<span class="st"> </span><span class="dv">2400</span>
(untidyextent &lt;-<span class="st"> </span><span class="kw">extent</span>(<span class="kw">sort</span>(<span class="kw">rnorm</span>(<span class="dv">4</span>) *<span class="st"> </span><span class="kw">sample</span>(<span class="dv">100</span>:<span class="dv">1000</span>, <span class="dv">1</span>))))
<span class="co">#&gt; class       : Extent </span>
<span class="co">#&gt; xmin        : -153.7848 </span>
<span class="co">#&gt; xmax        : -102.9653 </span>
<span class="co">#&gt; ymin        : 182.143 </span>
<span class="co">#&gt; ymax        : 566.2111</span>

(tidyextent &lt;-<span class="st"> </span><span class="kw"><a href="reference/bufext.html">bufext</a></span>(untidyextent, wholegrain))
<span class="co">#&gt; Warning: 'bufext' is deprecated.</span>
<span class="co">#&gt; Use 'buffer_extent' instead.</span>
<span class="co">#&gt; See help("Deprecated") and help("spex-deprecated").</span>
<span class="co">#&gt; class       : Extent </span>
<span class="co">#&gt; xmin        : -2400 </span>
<span class="co">#&gt; xmax        : 0 </span>
<span class="co">#&gt; ymin        : 0 </span>
<span class="co">#&gt; ymax        : 2400</span></code></pre></div>
</div>
<div id="decimate" class="section level1">
<h1 class="hasAnchor">
<a href="#decimate" class="anchor"></a>Decimate</h1>
<p>It may be that <code>raster::aggregate</code> is better than <code>decimate</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(r &lt;-<span class="st"> </span><span class="kw">raster</span>(volcano))
<span class="co">#&gt; class       : RasterLayer </span>
<span class="co">#&gt; dimensions  : 87, 61, 5307  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution  : 0.01639344, 0.01149425  (x, y)</span>
<span class="co">#&gt; extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : NA </span>
<span class="co">#&gt; data source : in memory</span>
<span class="co">#&gt; names       : layer </span>
<span class="co">#&gt; values      : 94, 195  (min, max)</span>
<span class="kw"><a href="reference/decimate.html">decimate</a></span>(r, <span class="dt">dec =</span> <span class="dv">6</span>)
<span class="co">#&gt; class       : RasterLayer </span>
<span class="co">#&gt; dimensions  : 14, 10, 140  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution  : 0.09836066, 0.06896552  (x, y)</span>
<span class="co">#&gt; extent      : 0, 0.9836066, 0.03448276, 1  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : NA </span>
<span class="co">#&gt; data source : in memory</span>
<span class="co">#&gt; names       : layer </span>
<span class="co">#&gt; values      : 95, 189  (min, max)</span>

(r2 &lt;-<span class="st"> </span><span class="kw">disaggregate</span>(r, <span class="dt">fact =</span> <span class="dv">25</span>))
<span class="co">#&gt; class       : RasterLayer </span>
<span class="co">#&gt; dimensions  : 2175, 1525, 3316875  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution  : 0.0006557377, 0.0004597701  (x, y)</span>
<span class="co">#&gt; extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : NA </span>
<span class="co">#&gt; data source : in memory</span>
<span class="co">#&gt; names       : layer </span>
<span class="co">#&gt; values      : 94, 195  (min, max)</span>
<span class="kw">system.time</span>(<span class="kw"><a href="reference/decimate.html">decimate</a></span>(r2, <span class="dv">25</span>))
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   1.052   0.292   1.346</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>License</h2>
<p><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Michael D. Sumner <br><small class="roles"> Author, maintainer </small> </li>
</ul>
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/r-gris/tabularaster"><img src="https://travis-ci.org/r-gris/tabularaster.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/r-gris/tabularaster"><img src="https://ci.appveyor.com/api/projects/status/github/r-gris/tabularaster?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://codecov.io/github/r-gris/tabularaster?branch=master"><img src="https://img.shields.io/codecov/c/github/r-gris/tabularaster/master.svg" alt="Coverage Status"></a></li>
</ul>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
